# ATC File Format Specification 1.7

##  Document History

| Version | Date        | Description                                                                  |
| ------- | ----------- | ---------------------------------------------------------------------------- |
| 1.1     | 14 Dec 2010 | Initial Version.                                                             |
| 1.2     | 8 Aug 2011  | Added filter flags. Corrected Example File Structure.                        |
| 1.3     | 7 Oct 2011  | Updated example data and descriptions.                                       |
| 1.4     | 21 May 2013 | Removed redundant bit flags in the ECG Format block.                         |
| 1.5     | 25 Sep 2018 | Added block IDs for 6 leads, removed unused ‘Filtered ECG Data Block’.       |
| 1.6     | 5 Jun 2019  | Added average beat data block, repurposed ‘Location’ field to ‘Device Data’. |
| 1.7     | 22 Jul 2021 | Adds 12-lead ecg, average beat, and median beat blocks.  New beat types. Reserves a flag for a multi-lead filter. |

## Introduction

This document is intended as a guide for reading files stored by AliveCor’s  ECG recorder.

## Overview

The ALIVE file format is a tagged file structure for storing ECG data and associated information.

## File Structure

ALIVE files consist of an 8 byte signature followed by a set of "blocks". Each block consists of a block identifier, a block length, followed by the block data and a CRC checksum.

|                  |
| ---------------- |
| File Signature   |
| File Version     |
| Block 1          |
| Block 2          |
| ...              |
| Block n          |

_General structure of ALIVE file_

### File Signature

The 8 byte signature at the beginning of the file is the hex bytes:  0x41 0x4C 0x49 0x56 0x45 0x00 0x00 0x00

`'A' 'L' 'I' 'V' 'E' '\0' '\0' '\0'`

_8 byte file signature_

### File Version

A 4 byte unsigned integer that indicates the version of the file format.

| Integer | Format Version |
| ------- | -------------- |
| 2       | <=1.4          |
| 3       | 1.5            |
| 4       | 1.6            |
| 5       | 1.7            |


### Block Structure

Blocks have the following format:

|            |                |                                                             |
| -----------| -------------- | ----------------------------------------------------------- |
| Identifier | 4 bytes        | An ASCII identifier for this block, e.g. "info" or "ecg ".  |
| Length     | 4 bytes        | Length of the data block in bytes (does not include the block identifier, length or checksum) |
| Data       | variable-sized | The block of data itself                                    |
| Checksum   | 4 bytes        | Cyclic sum of Block identifier, Block length and Block data |

### Checksum

The checksum is the CRC32 sum of all bytes in the block, which includes the Block identifier, Block length and Block data.


## Data Formats

### Byte Order

All multi-byte values are stored in Little-Endian (least significant byte first) order.

### Strings

ALIVE files contain strings of text for specifying comments, IDs, etc. Each string field is a fixed length, with zero padding for all unused bytes. A string must be less than or equal to the available byte length for that field. 

`'e', 'x', 'a', 'm', 'p', 'l', 'e', '\0', '\0', '\0'`

_10 Byte String Example_

## Info Block

The info block contains information about the ECG.  All string fields are optional and may be zero filled.


| Size | Type   | Description                          | Example                                         |
| ---- | ------ | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32 | Block ID                             | 'info'                                          |
| 4    | UInt32 | Block Data Length                    | 264                                             |
| 32   | String | Date Recorded. Conforms to ISO 8601 ‘YYYY-MM-DDThh:mm:ss.nnn±hh:mm’ | 2010-12-08T15:54:23.245+10:00 |
| 40   | String | Recording UUID (Universally unique identifier. Automatically generated by the recording software) | 58E0A7D7-EEBC-11D8-9669-0800200C9A66 |
| 44   | String | Mobile Phone UDID or other phone unique identifier.  Unused, intentionally left blank. | 2b6f0cc904d137be2e1730235f5664094b831186 |
| 32   | String | Mobile Phone Model                   | iPhone 4 : iPhone OS4.2                         |
| 32   | String | Recorder software                    | AliveECG v1.6.7                                 |
| 32   | String | Recorder hardware                    | kardia_mobile, kardia_band, triangle hwX.Y.Z fwX.Y.Zƒh |
| 52   | String |Device Data (Formerly Location) Comma-separated key/value pairs | SN=AC6L100010,BAT=55 |
| 4    | UInt32 | Checksum                             | 

## ECG Format Block

The ECG format block contains information about the format of the ECG data. Flags indicate the mains frequency and filters applied to stored ECG data. 

| Size | Type   | Description                          | Example                                         |
| ---- | ------ | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32 | Block ID                             | 'fmt '                                          |
| 4    | UInt32 | Block Data Length                    | 8                                               |
| 1    | BYTE   | ECG Format 0x01 = 16bit signed       | 1                                               |
| 2    | UInt16 | Recording UUID (Universally unique identifier. Automatically generated by the recording software) | 58E0A7D7-EEBC-11D8-9669-0800200C9A66 |
| 2    | UInt16 | Mobile Phone UDID or other phone unique identifier.  Unused, intentionally left blank. | 2b6f0cc904d137be2e1730235f5664094b831186 |
| 1    | BYTE   | Mobile Phone Model                   | iPhone 4 : iPhone OS4.2                         |
| 2    |        | Reserved                             |                                                 |
| 4    | UInt32 | Checksum                             |                                                 |


## ECG Data Block

The ecg data block contains the ECG samples for a single lead. An ATC file may contain 1 to 12 data blocks of time-aligned lead recordings. The block ID corresponds to the recording lead:

| Block ID | Lead     |
| -------- | -------- |
| 'ecg '   | Lead I   |
| 'ecg2'   | Lead II  |
| 'ecg3'   | Lead III |
| 'ecg4'   | aVR      |
| 'ecg5'   | aVL      |
| 'ecg6'   | aVF      |
| 'ecg7'   | V1       |
| 'ecg8'   | V2       |
| 'ecg9'   | V3       |
| 'ecga'   | V4       |
| 'ecgb'   | V5       |
| 'ecgc'   | V6       |

| Size | Type   | Description                          | Example                                         |
| ---- | ------ | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32 | Block ID                             | 'ecg '                                          |
| 4    | UInt32 | Block Data Length                    |                                                 |
| 2*n  | SInt16 | n samples of ECG data                |                                                 |
| 4    | UInt32 | Checksum                             |                                                 |


## Average/Median Beat Data Block

The average beat data block contains the computed average beat, generated for the specified lead.  The ‘Recorder Software’ field in the info block identifies the version of the software used to generate the average beat.
Average beats may be any length, but are typically 1.5 seconds (450 samples at 300 Hz).


| Block ID | Lead     |
| -------- | -------- |
| 'avg '   | Lead I   |
| 'avg2'   | Lead II  |
| 'avg3'   | Lead III |
| 'avg4'   | aVR      |
| 'avg5'   | aVL      |
| 'avg6'   | aVF      |
| 'avg7'   | V1       |
| 'avg8'   | V2       |
| 'avg9'   | V3       |
| 'avga'   | V4       |
| 'avgb'   | V5       |
| 'avgc'   | V6       |


| Block ID | Lead     |
| -------- | -------- |
| 'med '   | Lead I   |
| 'med2'   | Lead II  |
| 'med3'   | Lead III |
| 'med4'   | aVR      |
| 'med5'   | aVL      |
| 'med6'   | aVF      |
| 'med7'   | V1       |
| 'med8'   | V2       |
| 'med9'   | V3       |
| 'meda'   | V4       |
| 'medb'   | V5       |
| 'medc'   | V6       |


| Size | Type   | Description                          | Example                                         |
| ---- | ------ | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32 | Block ID                             | 'avg '                                          |
| 4    | UInt32 | Block Data Length                    |                                                 |
| 2*n  | SInt16 | n samples of ECG data                |                                                 |
| 4    | UInt32 | Checksum                             |                                                 |


## Annotation Block

The annotation block contains a list of QRS beat detections or other annotations. 

| Size | Type   | Description                          | Example                                         |
| ---- | ------ | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32 | Block ID                             | 'ann '                                          |
| 4    | UInt32 | Block Data Length 4+(6*n), n=number of annotations                    | 28             |
| 4    | UInt32 | Tick count frequency in ticks per second                              | 300            |
| 6*n  | UInt32 | Tick count offset from start of recording                             |  1500          |
|      | UInt16 | Beat Type                            |  1                                              |
| 4    | UInt32 | Checksum                             |                                                 |


| Beat Type | Description                 |
| --------- | --------------------------- |
| 0         | Unknown                     |
| 1         | Normal beat                 |
| 2         | Ventricular beat            |
| 3         | Atrial beat (not used)      |
| 4         | Fusion beat (not used)      |
| 5         | Junctional beat (not used)  |
| 6         | Paced (not used)            |

## 3axis Acceleration Data Block

Contains 3axis acceleration data. 

| Size | Type    | Description                          | Example                                         |
| ---- | ------- | ------------------------------------ | ----------------------------------------------- |
| 4    | UInt32  | Block ID                             | 'acc '                                          |
| 4    | UInt32  | Block Data Length (20*n), n=number of acceleration samples            |                |
| 4    | UInt32  | Tick count frequency in ticks per second                              | 1000000        |
| 20*n | UInt64  | Tick count offset, relative to the start of the ECG or start of the recording if no ECG data. |      |
|      | Float32 | X-Axis acceleration in Gs            |                                                 |
|      | Float32 | Y-Axis acceleration in Gs            |                                                 |
|      | Float32 | Z-Axis acceleration in Gs            |                                                 |
| 4    | UInt32  | Checksum                             |                                                 |


## Example File Structure

| Field                            | Offset  | Length | Contents                                                       |
| -------------------------------- | ------- | ------ | -------------------------------------------------------------- |
| ALIVE File Signature             | 0       | 8      | 0x41 0x4C 0x49 0x56 0x45 0x00 0x00 0x00                        |
| ALIVE File Signature             | 8       | 4      | 2                                                              |
| __Block ID__                     | 12      | 4      | 'info'                                                         |
| Length                           | 16      | 4      | 264                                                            |
| &nbsp;&nbsp;Date Recorded        | 20      | 32     | 2010-12-08T15:54:23.245+10:00                                  |
| &nbsp;&nbsp;Recording UUID       | 52      | 40     | 58E0A7D7-EEBC-11D8-9669-0800200C9A66                           |
| &nbsp;&nbsp;Phone UDID           | 92      | 44     |                                                                |
| &nbsp;&nbsp;Phone Model          | 136     | 32     | iPhone 4 : iPhone OS4.2                                        |
| &nbsp;&nbsp;Recorder Software    | 168     | 32     | AliveECG 1.6.7                                                 |
| &nbsp;&nbsp;Recorder Hardware    | 200     | 32     | 19kHz 200Hz/mV                                                 |
| &nbsp;&nbsp;Device Data          | 232     | 52     | SN=AC6L100010,BAT=85                                           |
| Checksum                         | 284     | 4      |                                                                |
| __Block ID__                     | 288     | 4      | 'fmt '                                                         |
| Length                           | 292     | 4      | 8                                                              |
| &nbsp;&nbsp;ECG Format           | 296     | 1      | 1                                                              |
| &nbsp;&nbsp;Sampling rate        | 297     | 2      | 300                                                            |
| &nbsp;&nbsp;Amplitude resolution | 299     | 2      | 500                                                            |
| &nbsp;&nbsp;Flags                | 301     | 1      | 14                                                             |
| &nbsp;&nbsp;Reserved             | 302     | 2      |                                                                |
| Checksum                         | 304     | 4      |                                                                |
| __Block ID__                     | 308     | 4      | 'ecg '                                                         |
| Length                           | 312     | 4      | 18000                                                          |
| &nbsp;&nbsp;ECG Sample 1         | 316     | 1      | 0                                                              |
| &nbsp;&nbsp;ECG Sample 2         | 318     | 2      | -297                                                           |
| &nbsp;&nbsp;ECG Sample 3         | 320     | 2      | 393                                                            |
| &nbsp;&nbsp;...                  |         |        |                                                                |
| &nbsp;&nbsp;ECG Sample 9000      |         | 2      | 4893                                                           |
| Checksum                         |         | 4      |                                                                |
| __Block ID__                     |         | 4      | 'ann '                                                         |
| Length                           |         | 4      | 28                                                             |
| Tick frequency                   |         | 4      | 300                                                            |
| &nbsp;&nbsp;Beat 1 offset        |         | 4      | 1500                                                           |
| &nbsp;&nbsp;Beat 1 type          |         | 2      | 0                                                              |
| &nbsp;&nbsp;Beat 2 offset        |         | 4      | 1800                                                           |
| &nbsp;&nbsp;Beat 2 type          |         | 2      | 1                                                              |
| &nbsp;&nbsp;Beat 3 offset        |         | 4      | 2100                                                           |
| &nbsp;&nbsp;Beat 3 type          |         | 2      | 1                                                              |
| &nbsp;&nbsp;Beat 4 offset        |         | 4      | 2400                                                           |
| &nbsp;&nbsp;Beat 4 type          |         | 2      | 1                                                              |
| Checksum                         |         | 4      |                                                                |
